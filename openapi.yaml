openapi: 3.0.0
info:
  title: Newsletter Dashboard
  description: |
    Used to manage your newsletter account, profile, API keys, and sender emails.

    ## Architecture Notes

    Admin endpoints (profile, brand, API keys) are handled by a consolidated Lambda function
    using a proxy routing pattern. All admin routes are routed through `/admin/{proxy+}` to
    the AdminFunction, which internally routes requests to the appropriate handler based on
    HTTP method and path.

    This architecture provides:
    - Reduced cold start overhead (single function vs multiple functions)
    - Simplified deployment and maintenance
    - Consistent error handling and logging
    - Shared authentication and authorization logic
  version: 1.0.0

tags:
  - name: API Keys
  - name: Profile
  - name: Senders
  - name: Issues

paths:
  /dashboard:
    get:
      summary: Dashboard
      responses:
        "200":
          description: Load summary data for a dashboard
          content:
            application/json:
              schema:
                type: object
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/UnknownError"

  /me:
    get:
      summary: Get my complete profile
      description: Retrieves the authenticated user's complete profile including brand and personal details
      tags:
        - Profile
      responses:
        "200":
          description: Complete user profile
          content:
            application/json:
              schema:
                type: object
                properties:
                  userId:
                    type: string
                  email:
                    type: string
                  username:
                    type: string
                    nullable: true
                  # Brand & Business Details
                  brand:
                    type: object
                    properties:
                      brandName:
                        type: string
                        nullable: true
                      website:
                        type: string
                        nullable: true
                      industry:
                        type: string
                        nullable: true
                      brandDescription:
                        type: string
                        nullable: true
                      brandLogo:
                        type: string
                        nullable: true
                      tags:
                        type: array
                        items:
                          type: string
                        nullable: true
                  # Personal Details
                  profile:
                    type: object
                    properties:
                      firstName:
                        type: string
                        nullable: true
                      lastName:
                        type: string
                        nullable: true
                      links:
                        type: array
                        items:
                          type: object
                          properties:
                            name:
                              type: string
                            url:
                              type: string
                        nullable: true
                  # Preferences
                  preferences:
                    type: object
                    properties:
                      timezone:
                        type: string
                        nullable: true
                      locale:
                        type: string
                        nullable: true
                  # Metadata
                  lastModified:
                    type: string
                    format: date-time
                  profileUpdatedAt:
                    type: string
                    format: date-time
                    nullable: true
                  brandUpdatedAt:
                    type: string
                    format: date-time
                    nullable: true
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/UnknownError"

  /profiles/{userId}:
    parameters:
      - name: userId
        in: path
        required: true
        schema:
          type: string
        description: The user id to look up
    get:
      summary: Get public profile by user id
      description: Retrieves another user's public profile information
      tags:
        - Profile
      responses:
        "200":
          description: Public user profile
          content:
            application/json:
              schema:
                type: object
                properties:
                  brand:
                    type: object
                    properties:
                      brandName:
                        type: string
                        nullable: true
                      website:
                        type: string
                        nullable: true
                      industry:
                        type: string
                        nullable: true
                      brandDescription:
                        type: string
                        nullable: true
                      brandLogo:
                        type: string
                        nullable: true
                      tags:
                        type: array
                        items:
                          type: string
                        nullable: true
                  profile:
                    type: object
                    properties:
                      firstName:
                        type: string
                        nullable: true
                      lastName:
                        type: string
                        nullable: true
                      links:
                        type: array
                        items:
                          type: object
                          properties:
                            name:
                              type: string
                            url:
                              type: string
                        nullable: true
                  lastModified:
                    type: string
                    format: date-time
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/UnknownError"

  /brand/logo:
    post:
      summary: Generate presigned URL for brand photo upload
      description: Generates a presigned URL for uploading a brand photo to S3
      tags:
        - Profile
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - fileName
                - contentType
              properties:
                fileName:
                  type: string
                  maxLength: 255
                  description: Name of the file to upload
                contentType:
                  type: string
                  enum:
                    [
                      "image/jpeg",
                      "image/jpg",
                      "image/png",
                      "image/gif",
                      "image/webp",
                    ]
                  description: MIME type of the image file
              additionalProperties: false
      responses:
        "200":
          description: Presigned URL generated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  uploadUrl:
                    type: string
                    description: Presigned URL for uploading the file
                  key:
                    type: string
                    description: S3 key where the file will be stored
                  expiresIn:
                    type: number
                    description: URL expiration time in seconds
                  maxSize:
                    type: number
                    description: Maximum file size in bytes (2MB)
                  publicUrl:
                    type: string
                    description: Public URL where the file will be accessible
        "400":
          $ref: "#/components/responses/BadRequest"
        "403":
          $ref: "#/components/responses/Forbidden"
        "500":
          $ref: "#/components/responses/UnknownError"

    put:
      summary: Confirm brand photo upload
      description: Confirms that a brand photo has been successfully uploaded and updates the tenant record
      tags:
        - Profile
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - key
              properties:
                key:
                  type: string
                  description: S3 key of the uploaded file
                fileName:
                  type: string
                  description: Original file name
              additionalProperties: false
      responses:
        "200":
          description: Brand photo confirmed and tenant record updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  photoUrl:
                    type: string
                    description: Public URL of the uploaded photo
                  key:
                    type: string
                    description: S3 key of the uploaded file
        "400":
          $ref: "#/components/responses/BadRequest"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/UnknownError"

  /brand/validate:
    get:
      summary: Validate brand ID
      description: Validates a brand ID format and checks if it's available for use as a tenant identifier
      parameters:
        - name: brandId
          in: query
          required: true
          schema:
            type: string
            minLength: 3
            maxLength: 50
            pattern: "^[a-z]+$"
          description: The brand ID to validate for availability
      responses:
        "200":
          description: Brand ID availability check result
          content:
            application/json:
              schema:
                type: object
                properties:
                  available:
                    type: boolean
                    description: Whether the brand ID is available
                  brandId:
                    type: string
                    description: The brand ID that was checked
                  suggestions:
                    type: array
                    description: Alternative brand ID suggestions if not available
                    items:
                      type: string
                  error:
                    type: string
                    description: Error message if brand ID format is invalid
        "400":
          $ref: "#/components/responses/BadRequest"
        "403":
          $ref: "#/components/responses/Forbidden"
        "500":
          $ref: "#/components/responses/UnknownError"

  /me/brand:
    put:
      summary: Update my brand details
      description: Updates the authenticated user's brand and business information
      tags:
        - Profile
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                brandId:
                  type: string
                  minLength: 3
                  maxLength: 50
                  pattern: "^[a-z]+$"
                  description: Unique brand identifier (becomes tenant ID and subdomain)
                brandName:
                  type: string
                  maxLength: 100
                  description: Brand or business name (primary identifier)
                website:
                  type: string
                  maxLength: 200
                  pattern: "^https?://.+"
                  description: Brand website URL
                industry:
                  type: string
                  maxLength: 100
                  description: Industry or business category
                brandDescription:
                  type: string
                  maxLength: 500
                  description: Brand description or mission statement
                brandLogo:
                  type: string
                  maxLength: 500
                  description: URL to brand logo image
                tags:
                  type: array
                  items:
                    type: string
                    maxLength: 50
                  maxItems: 10
                  description: Brand tags for categorization
              additionalProperties: false
              minProperties: 1
      responses:
        "200":
          description: Brand details updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  brand:
                    type: object
                    properties:
                      brandName:
                        type: string
                        nullable: true
                      website:
                        type: string
                        nullable: true
                      industry:
                        type: string
                        nullable: true
                      brandDescription:
                        type: string
                        nullable: true
                      brandLogo:
                        type: string
                        nullable: true
                      tags:
                        type: array
                        items:
                          type: string
                        nullable: true
                      updatedAt:
                        type: string
                        format: date-time
        "400":
          $ref: "#/components/responses/BadRequest"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/UnknownError"

  /me/profile:
    put:
      summary: Update my personal profile
      description: Updates the authenticated user's personal information and preferences
      tags:
        - Profile
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                firstName:
                  type: string
                  maxLength: 50
                  description: User's first name
                lastName:
                  type: string
                  maxLength: 50
                  description: User's last name
                timezone:
                  type: string
                  maxLength: 50
                  description: User's timezone (e.g., America/New_York)
                locale:
                  type: string
                  maxLength: 10
                  pattern: "^[a-z]{2}(-[A-Z]{2})?$"
                  description: User's locale (e.g., en-US)
                links:
                  type: array
                  items:
                    type: object
                    properties:
                      name:
                        type: string
                        maxLength: 100
                      url:
                        type: string
                        maxLength: 500
                    required: [name, url]
                  maxItems: 10
                  description: User's social/professional links
              additionalProperties: false
              minProperties: 1
      responses:
        "200":
          description: Personal profile updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  profile:
                    type: object
                    properties:
                      firstName:
                        type: string
                        nullable: true
                      lastName:
                        type: string
                        nullable: true
                      timezone:
                        type: string
                        nullable: true
                      locale:
                        type: string
                        nullable: true
                      links:
                        type: array
                        items:
                          type: object
                          properties:
                            name:
                              type: string
                            url:
                              type: string
                        nullable: true
                      updatedAt:
                        type: string
                        format: date-time
        "400":
          $ref: "#/components/responses/BadRequest"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/UnknownError"

  /api-keys:
    post:
      summary: Create a new API key
      description: Creates a new API key for the authenticated user
      tags:
        - API Keys
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
              properties:
                name:
                  type: string
                  maxLength: 100
                  description: Human-readable name for the API key
                description:
                  type: string
                  maxLength: 500
                  description: Optional description of the API key's purpose
                expiresAt:
                  type: string
                  format: date-time
                  description: Optional expiration date (ISO 8601 format)
              additionalProperties: false
      responses:
        "201":
          description: API key created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  apiKey:
                    type: object
                    properties:
                      keyId:
                        type: string
                        description: Unique identifier for the API key
                      name:
                        type: string
                      description:
                        type: string
                        nullable: true
                      keyValue:
                        type: string
                        description: The actual API key value (only shown once)
                      tenantId:
                        type: string
                        nullable: true
                      createdAt:
                        type: string
                        format: date-time
                      expiresAt:
                        type: string
                        format: date-time
                        nullable: true
                      status:
                        type: string
        "400":
          $ref: "#/components/responses/BadRequest"
        "403":
          $ref: "#/components/responses/Forbidden"
        "500":
          $ref: "#/components/responses/UnknownError"

    get:
      summary: List API keys
      description: Lists all API keys for the authenticated user
      tags:
        - API Keys
      responses:
        "200":
          description: List of API keys
          content:
            application/json:
              schema:
                type: object
                properties:
                  apiKeys:
                    type: array
                    items:
                      type: object
                      properties:
                        keyId:
                          type: string
                        name:
                          type: string
                        description:
                          type: string
                          nullable: true
                        keyValue:
                          type: string
                          description: Always shows "***hidden***"
                        tenantId:
                          type: string
                          nullable: true
                        createdAt:
                          type: string
                          format: date-time
                        lastUsed:
                          type: string
                          format: date-time
                          nullable: true
                        usageCount:
                          type: number
                        expiresAt:
                          type: string
                          format: date-time
                          nullable: true
                        status:
                          type: string
                        revokedAt:
                          type: string
                          format: date-time
                          nullable: true
                  count:
                    type: number
        "403":
          $ref: "#/components/responses/Forbidden"
        "500":
          $ref: "#/components/responses/UnknownError"

  /api-keys/{keyId}:
    parameters:
      - name: keyId
        in: path
        required: true
        schema:
          type: string
        description: The API key identifier
    get:
      summary: Get API key details
      description: Gets details of a specific API key (without the key value)
      tags:
        - API Keys
      responses:
        "200":
          description: API key details
          content:
            application/json:
              schema:
                type: object
                properties:
                  apiKey:
                    type: object
                    properties:
                      keyId:
                        type: string
                      name:
                        type: string
                      description:
                        type: string
                        nullable: true
                      keyValue:
                        type: string
                        description: Always shows "***hidden***"
                      tenantId:
                        type: string
                        nullable: true
                      createdAt:
                        type: string
                        format: date-time
                      lastUsed:
                        type: string
                        format: date-time
                        nullable: true
                      usageCount:
                        type: number
                      expiresAt:
                        type: string
                        format: date-time
                        nullable: true
                      status:
                        type: string
                      revokedAt:
                        type: string
                        format: date-time
                        nullable: true
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/UnknownError"

    delete:
      summary: Delete or revoke API key
      description: Deletes a specific API key permanently, or revokes it if revoke=true query parameter is provided
      tags:
        - API Keys
      parameters:
        - name: revoke
          in: query
          required: false
          schema:
            type: boolean
          description: If true, revokes the API key instead of deleting it
      responses:
        "200":
          description: API key deleted or revoked successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  keyId:
                    type: string
                  status:
                    type: string
                    description: Only present when revoking (status will be 'revoked')
                  revokedAt:
                    type: string
                    format: date-time
                    description: Only present when revoking
        "204":
          description: API key deleted successfully (no content)
        "400":
          $ref: "#/components/responses/BadRequest"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/UnknownError"

  /senders:
    get:
      summary: List sender emails
      tags:
        - Senders
      responses:
        "200":
          description: List of sender emails with tier limits
          content:
            application/json:
              schema:
                type: object
                properties:
                  senders:
                    type: array
                    items:
                      $ref: "#/components/schemas/SenderEmail"
                  tierLimits:
                    $ref: "#/components/schemas/TierLimits"
        "403":
          $ref: "#/components/responses/Forbidden"
        "500":
          $ref: "#/components/responses/UnknownError"

    post:
      summary: Create a new sender email
      tags:
        - Senders
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateSenderRequest"
      responses:
        "201":
          description: Sender email created successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SenderEmail"
        "400":
          $ref: "#/components/responses/BadRequest"
        "403":
          $ref: "#/components/responses/Forbidden"
        "409":
          description: Tier limit exceeded or email already exists
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                  tierLimits:
                    $ref: "#/components/schemas/TierLimits"
        "500":
          $ref: "#/components/responses/UnknownError"

  /senders/{senderId}:
    parameters:
      - name: senderId
        in: path
        required: true
        schema:
          type: string
        description: The sender ID
    get:
      summary: Get sender email verification status
      tags:
        - Senders
      responses:
        "200":
          description: Current sender verification status
          content:
            application/json:
              schema:
                type: object
                properties:
                  senderId:
                    type: string
                  email:
                    type: string
                  verificationStatus:
                    type: string
                    enum: [pending, verified, failed, verification_timed_out]
                  verificationType:
                    type: string
                    enum: [mailbox, domain]
                  domain:
                    type: string
                    nullable: true
                  isDefault:
                    type: boolean
                  createdAt:
                    type: string
                    format: date-time
                  updatedAt:
                    type: string
                    format: date-time
                  verifiedAt:
                    type: string
                    format: date-time
                    nullable: true
                  failureReason:
                    type: string
                    nullable: true
                  statusChanged:
                    type: boolean
                  sesStatus:
                    type: object
                    nullable: true
                  sesError:
                    type: string
                    nullable: true
                  lastChecked:
                    type: string
                    format: date-time
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/UnknownError"

    put:
      summary: Update sender email
      tags:
        - Senders
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateSenderRequest"
      responses:
        "200":
          description: Sender email updated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SenderEmail"
        "400":
          $ref: "#/components/responses/BadRequest"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/UnknownError"

    delete:
      summary: Delete sender email
      tags:
        - Senders
      responses:
        "204":
          description: Sender email deleted successfully
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/UnknownError"

  /senders/{senderId}/status:
    parameters:
      - name: senderId
        in: path
        required: true
        schema:
          type: string
        description: The sender ID
    get:
      summary: Get current sender verification status
      description: Check the current verification status of a sender email by querying both DynamoDB and SES directly
      tags:
        - Senders
      responses:
        "200":
          description: Current sender verification status
          content:
            application/json:
              schema:
                type: object
                properties:
                  senderId:
                    type: string
                  email:
                    type: string
                  name:
                    type: string
                    nullable: true
                  verificationType:
                    type: string
                    enum: [mailbox, domain]
                  verificationStatus:
                    type: string
                    enum: [pending, verified, failed, verification_timed_out]
                  isDefault:
                    type: boolean
                  domain:
                    type: string
                    nullable: true
                  createdAt:
                    type: string
                    format: date-time
                  updatedAt:
                    type: string
                    format: date-time
                  verifiedAt:
                    type: string
                    format: date-time
                    nullable: true
                  failureReason:
                    type: string
                    nullable: true
                  emailsSent:
                    type: integer
                  lastSentAt:
                    type: string
                    format: date-time
                    nullable: true
                  statusChanged:
                    type: boolean
                    description: Whether the status was updated during this request
                  sesStatus:
                    type: object
                    nullable: true
                    properties:
                      verificationStatus:
                        type: string
                      dkimStatus:
                        type: string
                      identityType:
                        type: string
                      error:
                        type: string
                  lastChecked:
                    type: string
                    format: date-time
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/UnknownError"

  /senders/verify-domain:
    post:
      summary: Initiate domain verification
      tags:
        - Senders
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/VerifyDomainRequest"
      responses:
        "201":
          description: Domain verification initiated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DomainVerification"
        "400":
          $ref: "#/components/responses/BadRequest"
        "403":
          $ref: "#/components/responses/Forbidden"
        "409":
          description: Domain already verified or verification in progress
        "500":
          $ref: "#/components/responses/UnknownError"

  /senders/domain-verification/{domain}:
    parameters:
      - name: domain
        in: path
        required: true
        schema:
          type: string
        description: The domain name
    get:
      summary: Get domain verification status and DNS records
      tags:
        - Senders
      responses:
        "200":
          description: Domain verification details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DomainVerification"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/UnknownError"

  /issues:
    get:
      summary: List all issues
      description: Retrieves a paginated list of newsletter issues for the authenticated user's tenant
      tags:
        - Issues
      parameters:
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
          description: Maximum number of issues to return (default 20, max 100)
        - name: nextToken
          in: query
          required: false
          schema:
            type: string
          description: Pagination token from previous response
        - name: status
          in: query
          required: false
          schema:
            type: string
            enum: [draft, scheduled, published, failed]
          description: Filter issues by status
      responses:
        "200":
          description: List of issues
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ListIssuesResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "403":
          $ref: "#/components/responses/Forbidden"
        "500":
          $ref: "#/components/responses/UnknownError"

    post:
      summary: Create a new issue
      description: Creates a new draft newsletter issue
      tags:
        - Issues
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateIssueRequest"
      responses:
        "201":
          description: Issue created successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CreateIssueResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "403":
          $ref: "#/components/responses/Forbidden"
        "500":
          $ref: "#/components/responses/UnknownError"

  /issues/trends:
    get:
      summary: Get issue performance trends
      description: Retrieves aggregated performance metrics and trends across all issues
      tags:
        - Issues
      parameters:
        - name: timeRange
          in: query
          required: false
          schema:
            type: string
            enum: [7d, 30d, 90d, all]
            default: 30d
          description: Time range for trend analysis (7 days, 30 days, 90 days, or all time)
      responses:
        "200":
          description: Issue trends and performance metrics
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TrendsResponse"
        "403":
          $ref: "#/components/responses/Forbidden"
        "500":
          $ref: "#/components/responses/UnknownError"

  /issues/{id}:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
        description: The issue ID (format: tenantId#issueNumber)
    get:
      summary: Get a single issue
      description: Retrieves detailed information about a specific issue including content and statistics
      tags:
        - Issues
      responses:
        "200":
          description: Issue details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GetIssueResponse"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/UnknownError"

    put:
      summary: Update an issue
      description: Updates an existing draft issue (published/scheduled issues cannot be updated)
      tags:
        - Issues
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateIssueRequest"
      responses:
        "200":
          description: Issue updated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GetIssueResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          $ref: "#/components/responses/Conflict"
        "500":
          $ref: "#/components/responses/UnknownError"

    delete:
      summary: Delete an issue
      description: Permanently deletes a draft issue (published/scheduled issues cannot be deleted)
      tags:
        - Issues
      responses:
        "204":
          description: Issue deleted successfully
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          $ref: "#/components/responses/Conflict"
        "500":
          $ref: "#/components/responses/UnknownError"

components:
  parameters:
    Tenant:
      name: tenant
      in: path
      required: true
      schema:
        type: string
      description: The tenant identifier

  responses:
    Created:
      description: Successfully added into the system
      content:
        application/json:
          schema:
            type: object
            required:
              - message
            properties:
              message:
                type: string
                description: Message resulting from a creation
                example: Contact created
    BadRequest:
      description: Unable to process request. Likely due to improperly formatted request.
      content:
        application/json:
          schema:
            type: object
            required:
              - message
            properties:
              message:
                type: string
                description: Message detailing what went wrong
                example: The 'name' field is required and is missing.
    Forbidden:
      description: Access denied. User does not have permission to perform this action.
      content:
        application/json:
          schema:
            type: object
            required:
              - message
            properties:
              message:
                type: string
                description: Message explaining the access denial
                example: Admin access required
    NotFound:
      description: The requested entity was not found
      content:
        application/json:
          schema:
            type: object
            required:
              - message
            properties:
              message:
                type: string
                description: The requested entity was not found
                example: Vote not found
    Conflict:
      description: The request conflicts with the current state of the resource
      content:
        application/json:
          schema:
            type: object
            required:
              - message
            properties:
              message:
                type: string
                description: Explanation of the conflict
                example: Cannot modify published issues
    UnknownError:
      description: An unexpected error occurred on the server.
      content:
        application/json:
          schema:
            type: object
            required:
              - message
            properties:
              message:
                type: string
                description: Unknown error message
                example: An unexpected error occurred.

  schemas:
    SenderEmail:
      type: object
      required:
        - senderId
        - email
        - verificationType
        - verificationStatus
        - isDefault
        - createdAt
        - updatedAt
      properties:
        senderId:
          type: string
          description: Unique identifier for the sender
        email:
          type: string
          format: email
          description: Sender email address
        name:
          type: string
          description: Display name for the sender
        verificationType:
          type: string
          enum: [mailbox, domain]
          description: Type of verification used
        verificationStatus:
          type: string
          enum: [pending, verified, failed, verification_timed_out]
          description: Current verification status
        isDefault:
          type: boolean
          description: Whether this is the default sender for the tenant
        domain:
          type: string
          description: Domain name (for domain verification)
        createdAt:
          type: string
          format: date-time
          description: When the sender was created
        updatedAt:
          type: string
          format: date-time
          description: When the sender was last updated
        verifiedAt:
          type: string
          format: date-time
          description: When the sender was verified
        failureReason:
          type: string
          description: Reason for verification failure
        emailsSent:
          type: integer
          description: Total number of emails sent from this sender
        lastSentAt:
          type: string
          format: date-time
          description: When the last email was sent from this sender
        verificationExpiresAt:
          type: string
          format: date-time
          description: When the verification expires (24 hours after initiation)

    TierLimits:
      type: object
      required:
        - tier
        - maxSenders
        - currentCount
        - canUseDNS
        - canUseMailbox
      properties:
        tier:
          type: string
          enum: [free-tier, creator-tier, pro-tier]
          description: User's current tier
        maxSenders:
          type: integer
          description: Maximum number of senders allowed
        currentCount:
          type: integer
          description: Current number of senders configured
        canUseDNS:
          type: boolean
          description: Whether DNS verification is allowed
        canUseMailbox:
          type: boolean
          description: Whether mailbox verification is allowed

    DomainVerification:
      type: object
      required:
        - domain
        - verificationStatus
        - dnsRecords
        - instructions
      properties:
        domain:
          type: string
          description: Domain name being verified
        verificationStatus:
          type: string
          enum: [pending, verified, failed, verification_timed_out]
          description: Current verification status
        dnsRecords:
          type: array
          items:
            $ref: "#/components/schemas/DnsRecord"
          description: DNS records to add for verification
        instructions:
          type: array
          items:
            type: string
          description: Step-by-step verification instructions

    DnsRecord:
      type: object
      required:
        - name
        - type
        - value
        - description
      properties:
        name:
          type: string
          description: DNS record name
        type:
          type: string
          description: DNS record type (TXT, CNAME, etc.)
        value:
          type: string
          description: DNS record value
        description:
          type: string
          description: User-friendly description of the record

    CreateSenderRequest:
      type: object
      required:
        - email
        - verificationType
      properties:
        email:
          type: string
          format: email
          description: Email address to verify
        name:
          type: string
          description: Display name for the sender
        verificationType:
          type: string
          enum: [mailbox, domain]
          description: Type of verification to use

    UpdateSenderRequest:
      type: object
      properties:
        name:
          type: string
          description: Display name for the sender
        isDefault:
          type: boolean
          description: Whether to set as default sender

    VerifyDomainRequest:
      type: object
      required:
        - domain
      properties:
        domain:
          type: string
          description: Domain name to verify

    ListIssuesResponse:
      type: object
      required:
        - issues
      properties:
        issues:
          type: array
          items:
            $ref: "#/components/schemas/IssueListItem"
          description: List of issues
        nextToken:
          type: string
          description: Pagination token for next page (only present if more results available)

    IssueListItem:
      type: object
      required:
        - id
        - issueNumber
        - title
        - slug
        - status
        - createdAt
      properties:
        id:
          type: string
          description: Issue identifier (format: tenantId#issueNumber)
        issueNumber:
          type: integer
          description: Sequential issue number
        title:
          type: string
          description: Issue title
        slug:
          type: string
          description: URL-friendly slug
        status:
          type: string
          enum: [draft, scheduled, published, failed]
          description: Current issue status
        createdAt:
          type: string
          format: date-time
          description: When the issue was created
        publishedAt:
          type: string
          format: date-time
          description: When the issue was published (only for published issues)
        scheduledAt:
          type: string
          format: date-time
          description: When the issue is scheduled to be published (only for scheduled issues)

    CreateIssueRequest:
      type: object
      required:
        - title
        - content
        - slug
      properties:
        title:
          type: string
          maxLength: 200
          description: Issue title
        content:
          type: string
          description: Issue content in markdown format
        slug:
          type: string
          maxLength: 100
          pattern: "^[a-z0-9-]+$"
          description: URL-friendly slug (lowercase, numbers, hyphens only)
        metadata:
          type: object
          description: Optional metadata for the issue

    CreateIssueResponse:
      type: object
      required:
        - id
        - issueNumber
        - title
        - slug
        - status
        - content
        - createdAt
        - updatedAt
      properties:
        id:
          type: string
          description: Issue identifier (format: tenantId#issueNumber)
        issueNumber:
          type: integer
          description: Sequential issue number
        title:
          type: string
          description: Issue title
        slug:
          type: string
          description: URL-friendly slug
        status:
          type: string
          enum: [draft]
          description: Issue status (always 'draft' for new issues)
        content:
          type: string
          description: Issue content in markdown format
        createdAt:
          type: string
          format: date-time
          description: When the issue was created
        updatedAt:
          type: string
          format: date-time
          description: When the issue was last updated

    GetIssueResponse:
      type: object
      required:
        - id
        - issueNumber
        - title
        - slug
        - status
        - content
        - createdAt
        - updatedAt
      properties:
        id:
          type: string
          description: Issue identifier (format: tenantId#issueNumber)
        issueNumber:
          type: integer
          description: Sequential issue number
        title:
          type: string
          description: Issue title
        slug:
          type: string
          description: URL-friendly slug
        status:
          type: string
          enum: [draft, scheduled, published, failed]
          description: Current issue status
        content:
          type: string
          description: Issue content in markdown format
        createdAt:
          type: string
          format: date-time
          description: When the issue was created
        updatedAt:
          type: string
          format: date-time
          description: When the issue was last updated
        publishedAt:
          type: string
          format: date-time
          description: When the issue was published (only for published issues)
        scheduledAt:
          type: string
          format: date-time
          description: When the issue is scheduled to be published (only for scheduled issues)
        metadata:
          type: object
          description: Optional metadata for the issue
        stats:
          $ref: "#/components/schemas/IssueStats"

    UpdateIssueRequest:
      type: object
      minProperties: 1
      properties:
        title:
          type: string
          maxLength: 200
          description: Issue title
        content:
          type: string
          description: Issue content in markdown format
        slug:
          type: string
          maxLength: 100
          pattern: "^[a-z0-9-]+$"
          description: URL-friendly slug (lowercase, numbers, hyphens only)
        scheduledAt:
          type: string
          format: date-time
          description: When to schedule the issue for publishing
        metadata:
          type: object
          description: Optional metadata for the issue

    IssueStats:
      type: object
      required:
        - opens
        - clicks
        - deliveries
        - bounces
        - complaints
      properties:
        opens:
          type: integer
          description: Number of email opens
        clicks:
          type: integer
          description: Number of link clicks
        deliveries:
          type: integer
          description: Number of successful deliveries
        bounces:
          type: integer
          description: Number of bounced emails
        complaints:
          type: integer
          description: Number of spam complaints

    TrendsResponse:
      type: object
      required:
        - totalIssues
        - publishedCount
        - avgOpenRate
        - avgClickRate
        - topPerformers
      properties:
        totalIssues:
          type: integer
          description: Total number of issues
        publishedCount:
          type: integer
          description: Number of published issues
        avgOpenRate:
          type: number
          format: double
          description: Average open rate across all published issues
        avgClickRate:
          type: number
          format: double
          description: Average click rate across all published issues
        topPerformers:
          type: array
          items:
            $ref: "#/components/schemas/TopPerformer"
          description: Top performing issues by engagement

    TopPerformer:
      type: object
      required:
        - id
        - title
        - openRate
        - clickRate
      properties:
        id:
          type: string
          description: Issue identifier
        title:
          type: string
          description: Issue title
        openRate:
          type: number
          format: double
          description: Open rate for this issue
        clickRate:
          type: number
          format: double
          description: Click rate for this issue
