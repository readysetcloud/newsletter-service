name: Deploy to Production

on:
  push:
    branches:
      - main

concurrency:
  group: ${{ github.ref_name }}

permissions:
  contents: read

env:
  BRANCH_NAME: ${{ github.event_name == 'workflow_dispatch' && github.ref_name || github.event_name == 'pull_request' && github.head_ref }}

jobs:
  predeploy-validations:
    name: Pre-deploy validations
    uses: ./.github/workflows/pre-deploy-validation.yaml

  deploy:
    name: Deploy
    runs-on: ubuntu-latest
    steps:
      - name: Call reusable deploy workflow
        uses: ./.github/workflows/sam.yaml
        with:
          aws-access-key-id: ${{ secrets.STAGE_ACCESS_KEY }}
          aws-secret-access-key: ${{ secrets.STAGE_SECRET_KEY }}
          environment: production
          distribution-list-id: 4e9ba0a2-7c0a-4946-93d9-7ece72d2d3aa
